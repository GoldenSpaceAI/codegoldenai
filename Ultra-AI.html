<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>GoldenSpaceAI • Ultra AI (Gemini 2.5 Pro)</title>
<meta name="color-scheme" content="dark light" />
<link rel="icon" href="/favicon.ico"/>

<style>
  :root{
    --bg:#05060a; --panel:#0b0f17; --panel2:#0a101b; --line:#1c273a;
    --text:#eef2ff; --muted:#aab5cf; --gold:#f6c64a; --gold2:#eb8b36; --accent:#7aa6ff;
    --good:#2dd4bf; --warn:#ffb020; --err:#ff6b6b; --shadow:0 30px 120px rgba(0,0,0,.45);
    --radius:18px; --radius-sm:12px; --max:1180px;
  }
  @media(prefers-color-scheme:light){
    :root{--bg:#f6f8ff; --panel:#ffffff; --panel2:#f9fbff; --line:#e8eef9; --text:#0c1222; --muted:#415172; --shadow:0 24px 80px rgba(10,15,30,.08)}
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0; background:
      radial-gradient(900px 420px at 85% -10%, rgba(246,198,74,.18), transparent 50%),
      radial-gradient(700px 380px at -10% 120%, rgba(122,166,255,.12), transparent 55%),
      var(--bg);
    color:var(--text); font:16px/1.6 Inter, ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, Arial;
  }

  header{
    position:sticky; top:0; z-index:10; backdrop-filter: blur(10px);
    background:linear-gradient(180deg, rgba(5,6,10,.8), rgba(5,6,10,.45) 60%, transparent);
    border-bottom:1px solid var(--line);
  }
  .top{max-width:var(--max); margin:0 auto; padding:14px 16px; display:flex; align-items:center; gap:12px}
  .brand{display:flex; align-items:center; gap:10px; font-weight:900; letter-spacing:.3px}
  .orb{width:24px;height:24px;border-radius:50%;
    background:conic-gradient(from 210deg, var(--gold), var(--gold2), var(--gold));
    box-shadow:0 0 0 2px rgba(246,198,74,.35), 0 0 40px rgba(246,198,74,.25) inset;
  }
  .badge{font-size:12px;font-weight:800;color:#151109;background:linear-gradient(180deg,var(--gold),var(--gold2));
    padding:4px 10px;border-radius:999px; box-shadow:0 6px 18px rgba(246,198,74,.25)}
  .sp{flex:1}
  .pill{display:inline-flex; gap:8px; align-items:center; padding:8px 12px; border-radius:12px;
    border:1px solid var(--line); color:var(--muted); background:transparent; cursor:pointer; font-weight:800}
  .pill:hover{filter:brightness(1.05)}
  .go{background:linear-gradient(180deg,var(--gold),var(--gold2)); color:#1b1504; border:0}

  main{max-width:var(--max); margin:14px auto; padding:0 16px; display:grid; grid-template-columns: 280px 1fr; gap:16px}
  @media(max-width:980px){ main{ grid-template-columns:1fr } }

  /* Left panel */
  .side{
    background:linear-gradient(180deg,var(--panel),var(--panel2));
    border:1px solid var(--line); border-radius:var(--radius); box-shadow:var(--shadow); padding:14px;
    display:flex; flex-direction:column; gap:12px; height:fit-content
  }
  .stat{display:flex; align-items:center; gap:10px; padding:10px; border:1px solid var(--line); border-radius:12px}
  .stat i{font-style:normal; font-weight:900; color:var(--gold2)}
  .unlock{
    display:flex; flex-direction:column; gap:8px; padding:12px; border:1px dashed var(--line); border-radius:12px;
    background:rgba(246,198,74,.06)
  }
  .unlock input{width:100%; padding:10px 12px; border-radius:10px; border:1px solid var(--line); background:transparent; color:var(--text)}
  .unlock button{align-self:flex-end}

  /* Chat area */
  .chatwrap{
    background:linear-gradient(180deg,var(--panel),var(--panel2));
    border:1px solid var(--line); border-radius:var(--radius); box-shadow:var(--shadow);
    display:flex; flex-direction:column; min-height:68vh; overflow:hidden
  }
  .msgs{padding:20px; overflow:auto; max-height:65vh}
  .msg{max-width:min(820px,92%); padding:14px 16px; border-radius:16px; margin:8px 0; line-height:1.6; border:1px solid var(--line)}
  .msg.ai{ background:rgba(122,166,255,.08) }
  .msg.user{ background:rgba(246,198,74,.12); margin-left:auto }
  .msg small{display:block; opacity:.65; font-size:12px; margin-bottom:6px}
  .code{background:#0e1626; color:#eaf1ff; padding:12px; border-radius:10px; overflow:auto; font-family:ui-monospace,SFMono-Regular,Menlo,Consolas,monospace; font-size:.92rem}
  .warn{display:inline-flex; align-items:center; gap:8px; color:#1c1504; background:linear-gradient(180deg,#ffd56a,#f6c64a);
        border-radius:12px; padding:6px 10px; font-weight:900}

  .composer{display:flex; gap:10px; padding:12px; border-top:1px solid var(--line); background:rgba(0,0,0,.04)}
  .composer textarea{flex:1; resize:none; min-height:56px; max-height:140px; padding:12px 14px; border-radius:12px;
    border:1px solid var(--line); background:transparent; color:var(--text); outline:none}
  .btn{height:56px; min-width:56px; padding:0 16px; border-radius:14px; border:1px solid var(--line); background:transparent; color:var(--text);
       font-weight:900; cursor:pointer}
  .btn.send{background:linear-gradient(180deg,var(--gold),var(--gold2)); color:#1c1504; border:0; box-shadow:0 10px 24px rgba(246,198,74,.25)}
  .btn.stop{background:#2f3342}
  .spinner{width:18px;height:18px;border-radius:50%; border:2px solid rgba(255,255,255,.25); border-top-color:var(--gold); animation:spin 1s linear infinite; display:inline-block; vertical-align:middle}
  @keyframes spin{to{transform:rotate(360deg)}}

  .toast{position:fixed; right:14px; bottom:14px; background:#0d1525; border:1px solid var(--line); color:#ffdca1; padding:10px 12px; border-radius:10px; box-shadow:var(--shadow); opacity:0; transform:translateY(6px); transition:.25s}
  .toast.show{opacity:1; transform:translateY(0)}
</style>
</head>
<body>

<header>
  <div class="top">
    <div class="brand"><span class="orb"></span> GoldenSpaceAI</div>
    <span class="badge">ULTRA • Gemini 2.5 Pro</span>
    <div class="sp"></div>
    <a class="pill" href="/index.html">Home</a>
    <button id="newChat" class="pill">New Chat</button>
  </div>
</header>

<main>
  <!-- LEFT SIDEBAR -->
  <aside class="side">
    <div class="stat"><i>◎</i> <div><strong>Model:</strong> Gemini 2.5 Pro<br><small style="color:var(--muted)">Premium reasoning & fidelity</small></div></div>
    <div class="stat"><i>⚡</i> <div><strong>Status:</strong> <span id="status">Ready</span></div></div>
    <div class="unlock">
      <div style="font-weight:900">Unlock Ultra</div>
      <small style="color:var(--muted)">Enter your unlock code (must end with <b>777999888654</b>). Saved to this device only.</small>
      <input id="unlock" placeholder="Enter unlock code"/>
      <button id="unlockBtn" class="pill go">Unlock</button>
      <small id="unlockNote" style="color:var(--muted)"></small>
    </div>
    <div class="stat"><i>ℹ︎</i> <div><strong>Tip:</strong> Paste code or files; Ultra will explain and improve them.</div></div>
  </aside>

  <!-- CHAT PANE -->
  <section class="chatwrap">
    <div id="stream" class="msgs">
      <div class="msg ai">
        <small>Ultra AI</small>
        Welcome to <b>Ultra AI</b>. Ask complex, multi-step questions — I’ll respond with structured, professional answers.  
        <div style="margin-top:8px" class="warn">💎 Ultra active • Gemini 2.5 Pro</div>
      </div>
    </div>

    <div class="composer">
      <textarea id="prompt" placeholder="Ask anything premium… (Shift+Enter = newline)"></textarea>
      <button id="send" class="btn send">Send ➤</button>
    </div>
  </section>
</main>

<div id="toast" class="toast">Saved</div>

<script>
  // ========= Config =========
  const BACKEND = "/api/generate-ultra";   // backend route
  const KEY_ENDING = "777999888654";       // unlock ending
  const STORE_KEY  = "gsai:ultra:unlock";  // localStorage key

  // ========= Elements =========
  const stream  = document.getElementById("stream");
  const promptE = document.getElementById("prompt");
  const sendBtn = document.getElementById("send");
  const statusE = document.getElementById("status");
  const unlockI = document.getElementById("unlock");
  const unlockB = document.getElementById("unlockBtn");
  const unlockN = document.getElementById("unlockNote");
  const newChat = document.getElementById("newChat");
  const toast   = document.getElementById("toast");

  // ========= NEW: in-browser chat memory (last 20) =========
  let messages = []; // { role: "user" | "assistant", content: "..." }

  // ========= Unlock =========
  const saved = localStorage.getItem(STORE_KEY) || "";
  if(saved) unlockI.value = saved;
  function hasAccess(){
    const v = (localStorage.getItem(STORE_KEY) || "").trim();
    return v && v.endsWith(KEY_ENDING);
  }
  function requireAccess(){
    if(!hasAccess()){
      addAI("🔒 Ultra is locked. Enter a valid unlock code in the left panel.");
      return false;
    }
    return true;
  }
  unlockB.addEventListener("click", ()=>{
    const val = (unlockI.value||"").trim();
    if(!val || !val.endsWith(KEY_ENDING)){
      unlockN.textContent = "Invalid code. It must end with " + KEY_ENDING + ".";
      unlockN.style.color = "var(--err)";
      showToast("Invalid code");
      return;
    }
    localStorage.setItem(STORE_KEY, val);
    unlockN.textContent = "Ultra unlocked on this device.";
    unlockN.style.color = "var(--good)";
    showToast("Ultra unlocked");
  });

  // ========= Chat helpers =========
  function el(tag, attrs={}, ...kids){
    const n = document.createElement(tag);
    for(const [k,v] of Object.entries(attrs)){
      if(k==="class") n.className=v;
      else if(k==="html") n.innerHTML=v;
      else n.setAttribute(k,v);
    }
    for(const k of kids) n.append(k instanceof Node ? k : document.createTextNode(k));
    return n;
  }
  function addUser(text){
    const m = el("div",{class:"msg user"});
    m.append(el("small",{},"You"));
    m.append(el("div",{html:escapeHtml(text).replace(/\n/g,"<br/>")}));
    stream.append(m); stream.scrollTop = stream.scrollHeight;
  }
  function addAI(text){
    const m = el("div",{class:"msg ai"});
    m.append(el("small",{},"Ultra AI"));
    m.append(el("div",{html:text}));
    stream.append(m); stream.scrollTop = stream.scrollHeight;
    return m;
  }
  function addSpinner(){
    const m = el("div",{class:"msg ai"});
    m.append(el("small",{},"Ultra AI"));
    m.append(el("div",{html:'<span class="spinner"></span> Thinking…'}));
    stream.append(m); stream.scrollTop = stream.scrollHeight;
    return m;
  }
  function showToast(t){
    toast.textContent = t;
    toast.classList.add("show");
    setTimeout(()=>toast.classList.remove("show"), 1400);
  }
  function escapeHtml(t){
    return (t||"").replace(/[&<>\"']/g, m => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#039;'}[m]));
  }

  // ========= Send =========
  async function send(){
    const q = (promptE.value||"").trim();
    if(!q) return;
    if(!requireAccess()) return;

    addUser(q);
    messages.push({ role:"user", content:q });           // store user msg
    const row = addSpinner();
    sendBtn.disabled = true; statusE.textContent = "Working…";

    try{
      const r = await fetch(BACKEND, {
        method:"POST",
        headers:{"Content-Type":"application/json"},
        body: JSON.stringify({ messages: messages.slice(-20) }) // send last 20
      });

      if(!r.ok){
        stream.removeChild(row);
        addAI(`<div class="warn">⚠️ No reply from Ultra AI. (${r.status})</div>`);
      }else{
        const j = await r.json();
        stream.removeChild(row);

        const text = (j.text || j.reply || j.answer || "").trim();
        if(!text){
          addAI(`<div class="warn">⚠️ No reply from Ultra AI.</div>`);
        }else{
          const html = escapeHtml(text)
            .replace(/```([\s\S]*?)```/g, (_m, p1) => `<pre class="code">${escapeHtml(p1).trim()}</pre>`)
            .replace(/\n/g,"<br/>");
          addAI(html);
          messages.push({ role:"assistant", content:text }); // store AI reply
        }
      }
    }catch(e){
      stream.removeChild(row);
      addAI(`<div class="warn">⚠️ ${escapeHtml(e.message)}</div>`);
    }finally{
      sendBtn.disabled = false; statusE.textContent = "Ready";
      promptE.value = "";
      stream.scrollTop = stream.scrollHeight;
    }
  }

  sendBtn.addEventListener("click", send);
  promptE.addEventListener("keydown", e=>{
    if(e.key==="Enter" && !e.shiftKey){ e.preventDefault(); send(); }
  });
  newChat.addEventListener("click", ()=>{
    stream.innerHTML = "";
    addAI('New chat started. <span class="warn">💎 Ultra active • Gemini 2.5 Pro</span>');
    messages = []; // reset history
  });
</script>
</body>
</html>
